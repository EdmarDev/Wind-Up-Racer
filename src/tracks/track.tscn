[gd_scene load_steps=13 format=2]

[ext_resource path="res://src/vehicle/vehicle.tscn" type="PackedScene" id=1]
[ext_resource path="res://test/test_camera.gd" type="Script" id=2]
[ext_resource path="res://test/test_mat.material" type="Material" id=3]

[sub_resource type="Shader" id=3]
code = "shader_type spatial;

uniform vec4 c1 : hint_color = vec4(1, 1, 1, 1);
uniform vec4 c2 : hint_color = vec4(.2, .2, .2, 1);

varying vec3 vertex_pos;

void vertex(){
	vertex_pos = VERTEX;
}

void fragment() {
	bool x_even = int(vertex_pos.x * .5) % 2 == 1;
	bool z_even = int(vertex_pos.z * .5) % 2 == 1;
	bool y_even = int(vertex_pos.y * .5) % 2 == 1;
	
	if(sign(vertex_pos.x) < 0.0)
		x_even = !x_even;
	if(sign(vertex_pos.z) < 0.0)
		z_even = !z_even;
	if(sign(vertex_pos.y) < 0.0)
		y_even = !y_even;
	
	if(y_even){
		x_even = !x_even;
	}
	
	if(x_even && z_even || !x_even && !z_even)
		ALBEDO = c2.xyz;
	else
		ALBEDO = c1.xyz;
}"

[sub_resource type="ShaderMaterial" id=4]
shader = SubResource( 3 )
shader_param/c1 = Color( 0.843137, 0.803922, 0.631373, 1 )
shader_param/c2 = Color( 0.741176, 0.709804, 0.572549, 1 )

[sub_resource type="CylinderMesh" id=5]
material = SubResource( 4 )
top_radius = 90.0
bottom_radius = 90.0

[sub_resource type="Curve3D" id=6]
_data = {
"points": PoolVector3Array( 0, 0, 0, -7.27443, 0, 4.7765, -50.337, -9.53674e-07, -59.7095, 2.75611, 0, -8.45936, -2.75611, 0, 8.45936, -71.9733, -9.53674e-07, -38.0732, -0.825344, 0, -4.41055, 0.825344, 0, 4.41055, -77.8741, -9.53674e-07, -13.8144, -1.49207, 0, -6.47675, 1.49207, 0, 6.47675, -74.268, -9.53674e-07, 17.3287, -3.43268, 0, -4.92924, 3.43268, 0, 4.92924, -61.1142, 2.55788, 46.8362, -7.04746, 0, -2.73391, 7.04746, 0, 2.73391, -30.0052, 3.11927, 71.6773, -7.90776, 0, 0.464603, 7.90776, 0, -0.464603, 13.6659, 5.97605, 74.6161, -7.86009, 0, 3.7104, 7.86009, 0, -3.7104, 47.7736, -9.53674e-07, 55.8311, 2.97643, 0, 8.11758, -2.97643, 0, -8.11758, 61.376, -9.53674e-07, 38.1663, 3.06187, 0, 6.41719, -3.06187, 0, -6.41719, 41.8938, -9.53674e-07, 25.7194, -6.25819, 0, 5.89008, 6.25819, 0, -5.89008, 44.9557, -9.53674e-07, 1.94996, -5.15384, 0, 8.8351, 5.15384, 0, -8.8351, 71.0929, -9.53674e-07, -7.62141, 4.04942, 0, 10.3076, -4.04942, 0, -10.3076, 78.4555, -9.53674e-07, -30.8136, 10.9404, 0, 2.65826, -10.9404, 0, -2.65826, 36.1563, -9.53674e-07, -14.6447, 0.206413, 0, 4.12819, -0.206413, 0, -4.12819, 25.423, -9.53674e-07, -51.592, 3.96097, 0, -0.339008, -3.96097, 0, 0.339008, 19.3193, -1.03402, -84.2126, 0.412819, 0, -5.57306, -0.412819, 0, 5.57306, 11.1807, -9.53674e-07, -48.7023, 11.8443, 0, -1.77374, -11.8443, 0, 1.77374, 4.36414, -9.53674e-07, 3.92773, 12.1415, 0, 8.71023, -12.1415, 0, -8.71023, -21.4007, -9.53674e-07, -16.8172, -6.07077, 0, 5.80682, 6.07077, 0, -5.80682, -22.9844, -9.53674e-07, -46.3791, 14.4929, 0, 7.19351, -14.4929, 0, -7.19351, -21.3895, -9.53674e-07, -79.9514, 0, 0, 0, -7.27443, 0, 4.7765, -50.337, -9.53674e-07, -59.7095 ),
"tilts": PoolRealArray( 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 )
}

[sub_resource type="ShaderMaterial" id=7]
shader = SubResource( 3 )
shader_param/c1 = Color( 0.74902, 0.670588, 0.541176, 1 )
shader_param/c2 = Color( 0.635294, 0.552941, 0.415686, 1 )

[sub_resource type="CubeMesh" id=10]
material = ExtResource( 3 )
size = Vector3( 4, 10, 20 )

[sub_resource type="BoxShape" id=11]
extents = Vector3( 2, 5, 10 )

[sub_resource type="ShaderMaterial" id=9]
shader = SubResource( 3 )
shader_param/c1 = Color( 0.898039, 0.898039, 0.898039, 1 )
shader_param/c2 = Color( 0.529412, 0.529412, 0.529412, 1 )

[sub_resource type="CylinderMesh" id=8]
material = SubResource( 9 )
height = 10.0
rings = 8

[node name="track" type="Spatial"]

[node name="background" type="Spatial" parent="."]

[node name="base_ground" type="MeshInstance" parent="background"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -10, 0 )
mesh = SubResource( 5 )
material/0 = null

[node name="road" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 9.53674e-07, 2.38419e-07 )

[node name="Path" type="Path" parent="road"]
curve = SubResource( 6 )

[node name="CSGPolygon" type="CSGPolygon" parent="road"]
use_collision = true
invert_faces = true
polygon = PoolVector2Array( -6, -0.25, -6, 0.25, 6, 0.25, 6, -0.25 )
mode = 2
path_node = NodePath("../Path")
path_interval = 1.0
path_rotation = 2
path_local = false
path_continuous_u = false
path_joined = true
material = SubResource( 7 )

[node name="walls" type="Spatial" parent="."]

[node name="StaticBody" type="StaticBody" parent="walls"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 19.376, 0, -68.082 )

[node name="MeshInstance" type="MeshInstance" parent="walls/StaticBody"]
mesh = SubResource( 10 )
material/0 = null

[node name="CollisionShape" type="CollisionShape" parent="walls/StaticBody"]
shape = SubResource( 11 )

[node name="StaticBody2" type="StaticBody" parent="walls"]
transform = Transform( -0.557397, 0, -0.830246, 0, 1, 0, 0.830246, 0, -0.557397, -65.3689, 3.91486, 49.3638 )

[node name="MeshInstance" type="MeshInstance" parent="walls/StaticBody2"]
mesh = SubResource( 10 )
material/0 = null

[node name="CollisionShape" type="CollisionShape" parent="walls/StaticBody2"]
shape = SubResource( 11 )

[node name="DirectionalLight" type="DirectionalLight" parent="."]
transform = Transform( 0.994815, 0.029783, 0.0972399, -0.101699, 0.291337, 0.951199, 0, -0.956157, 0.292856, 0, 12.5705, 0 )

[node name="vehicle" parent="." instance=ExtResource( 1 )]
transform = Transform( -0.99987, 0, -0.0161434, 0, 1, 0, 0.0161434, 0, -0.99987, -78.5173, 1.12879, 0 )

[node name="Camera" type="Camera" parent="."]
transform = Transform( -0.989234, 0, 0.146342, 0, 1, 0, -0.146342, 0, -0.989234, -78.197, 3.629, -3.998 )
fov = 85.0
far = 500.0
script = ExtResource( 2 )

[node name="MeshInstance" type="MeshInstance" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -68.1232, 0, 0 )
mesh = SubResource( 8 )
material/0 = null

[node name="MeshInstance2" type="MeshInstance" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -84.7595, 0, 0 )
mesh = SubResource( 8 )
material/0 = SubResource( 9 )
